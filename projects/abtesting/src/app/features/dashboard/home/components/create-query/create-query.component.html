<div
  #metricsTable
  class="create-query-container"
>
 <!-- TODO: Translate text -->
  <ng-container *ngIf="options[0]?.length; else zeroState">
    <span class="ft-16-400">Metric</span>
    <form class="key-selection-form" [formGroup]="metricSelectionForm">
      <div class="auto-complete-container">
        <ng-container formArrayName="keys">
          <div *ngFor="let key of keys.controls; let formIndex = index">
            <ng-container [formGroupName]="formIndex">
              <mat-form-field class="auto-complete">
                <input
                  type="text"
                  placeholder="Key"
                  matInput
                  formControlName="metricKey"
                  [matAutocomplete]="auto"
                  >
                <mat-autocomplete (optionSelected)="selectedOption($event)" #auto="matAutocomplete" [displayWith]="displayFn">
                  <mat-option *ngFor="let option of filteredOptions[formIndex] | async" [value]="option">
                    {{option.key}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </ng-container>
            <mat-icon *ngIf="(formIndex + 1) !== keys.controls.length" class="icon">arrow_right_alt</mat-icon>
          </div>
        </ng-container>
      </div>
      <button
        mat-flat-button
        color="primary"
        class="ft-12-600 btn"
        (click)="resetForm()"
        type="button"
        >
        <mat-icon class="icon">clear</mat-icon>
        <span>CLEAR</span>
      </button>
      <div class="secondary-form" *ngIf="isKeySelected">
        <mat-form-field class="ft-14-600 form-control">
          <input
            matInput
            class="ft-14-400"
            [placeholder]="'query.table-query-name.text' | translate"
            formControlName="queryName"
          />
        </mat-form-field>

        <mat-form-field class="ft-14-600 form-control">
          <mat-label>{{ 'query.table-operation.text' | translate | titlecase }}</mat-label>
          <mat-select class="ft-14-400" formControlName="operationType">
            <mat-option
              *ngFor="let operation of queryOperations"
              [value]="operation.value"
            >
              {{ operation.viewValue | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="ft-14-600 form-control">
          <mat-label>{{ 'query.form-compareFn.text' | translate | titlecase }}</mat-label>
          <mat-select class="ft-14-400" formControlName="compareFn">
            <mat-option
              *ngFor="let fn of comparisonFns"
              [value]="fn.value"
            >
              {{ fn.viewValue | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="ft-14-600 form-control">
          <input
            matInput
            class="ft-14-400"
            [placeholder]="'query.form-compare-value.text' | translate"
            formControlName="compareValue"
          />
        </mat-form-field>
      </div>
      <button
        *ngIf="isKeySelected"
        mat-flat-button
        color="primary"
        class="default-button btn btn--save"
        [ngClass]="{ 'default-button--disabled': !this.metricSelectionForm.valid }"
        [disabled]="!this.metricSelectionForm.valid"
        (click)="saveQuery()"
      >
        <span>SAVE</span>
      </button>
    </form>
  </ng-container>
</div>

<ng-template #zeroState>
  <span
    *ngIf="!(isAnalysisMetricsLoading$ | async)"
    class="zero-state"
    [innerHTML]="'global.no-metrics.text' | translate"
  >
  </span>
</ng-template>
